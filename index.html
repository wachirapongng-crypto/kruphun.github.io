<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ระบบตรวจสอบครุภัณฑ์</title>
<style>
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background: #4CAF50; color: white; }
select, button { padding: 5px; margin: 2px; }
</style>
</head>
<body>

<h2>ข้อมูล WAIT</h2>
<table id="waitTable">
  <thead>
    <tr>
      <th>รหัส</th><th>ชื่อ</th><th>ที่อยู่</th><th>สถานะ</th><th>วันที่</th><th>เวลา</th><th>อัปเดต</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<label>เลือกที่อยู่:</label>
<select id="location">
  <option>501</option><option>502</option><option>503</option>
  <option>401</option><option>401A</option><option>401B</option><option>401C</option>
  <option>402</option><option>403</option><option>404</option><option>405</option>
  <option>ห้องพักครู</option><option>301</option><option>302</option>
</select>

<label>เลือกสถานะ:</label>
<select id="status">
  <option>ใช้งานได้</option>
  <option>ชำรุด</option>
  <option>เสื่อมสภาพ</option>
  <option>หมดอายุการใช้งาน</option>
  <option>ไม่รองรับการใช้งาน</option>
</select>

<button onclick="updateSelected()">อัปเดตข้อมูล</button>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwpvwogGdPgP3r-N-l_Uh1_qa9rTw4mmEmSJyfspP5xt7hFM_se8Zbddn_qS-39BOga/exec"; // ใส่ URL จาก Deploy

let selectedCode = null;

async function loadData(){
  const res = await fetch(API_URL+"?action=getWait");
  const data = await res.json();
  const tbody = document.querySelector("#waitTable tbody");
  tbody.innerHTML = "";

  data.forEach(r=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.code}</td><td>${r.name}</td><td>${r.address}</td>
      <td>${r.status}</td><td>${r.date}</td><td>${r.time}</td>
      <td><button onclick="selectRow('${r.code}')">เลือก</button></td>
    `;
    tbody.appendChild(tr);
  });
}

function selectRow(code){ 
  selectedCode = code; 
  alert("เลือก รหัส: "+code); 
}

async function updateSelected(){
  if(!selectedCode){ alert("กรุณาเลือกข้อมูลก่อน"); return; }
  const location = document.getElementById("location").value;
  const status = document.getElementById("status").value;

  const res = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({action:"updateLog", code:selectedCode, location, status})
  });
  const result = await res.json();
  if(result.status=="success"){
    alert("อัปเดตเรียบร้อย");
    selectedCode = null;
    loadData();
  }else{
    alert("เกิดข้อผิดพลาด");
  }
}

window.onload = loadData;
</script>

</body>
</html>
